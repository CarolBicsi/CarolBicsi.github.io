function _createForOfIteratorHelperLoose(e,s){var t,r;if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator])return(t=e[Symbol.iterator]()).next.bind(t);if(Array.isArray(e)||(t=_unsupportedIterableToArray(e))||s&&e&&"number"==typeof e.length)return t&&(e=t),r=0,function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,s){var t;if(e)return"string"==typeof e?_arrayLikeToArray(e,s):"Map"===(t="Object"===(t=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,s):void 0}function _arrayLikeToArray(e,s){(null==s||s>e.length)&&(s=e.length);for(var t=0,r=new Array(s);t<s;t++)r[t]=e[t];return r}function DisqusJS(e){function r(){for(var e=arguments.length,s=new Array(e),t=0;t<e;t++)s[t]=arguments[t];return(r=Object.assign||function(e){for(var s,t=_createForOfIteratorHelperLoose(arguments);!(s=t()).done;){var r,n=s.value;for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,s)}function s(){var e;n.DISQUS?n.DISQUS.reset({reload:!0,config:function(){this.page.identifier=_.config.identifier,this.page.url=_.config.url,this.page.title=_.config.title}}):(e=h.createElement("script"),v(l).innerHTML='<div id="dsqjs"><section><div id="dsqjs-msg">评论完整模式加载中... 如果长时间无法加载，请针对 disq.us | disquscdn.com | disqus.com 启用代理，或切换至 <a id="dsqjs-force-dsqjs" class="dsqjs-msg-btn">评论基础模式</a></div></section>'+y+"</div>",v("dsqjs-force-dsqjs").addEventListener(j,q),e.src="https://"+_.config.shortname+".disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(h.head||h.body).appendChild(e))}function f(){v(l).innerHTML='<div id="dsqjs"><section><div id="dsqjs-msg">正在检查 Disqus 能否访问...</div></section>'+y+"</div>";for(var e=["disqus.com",_.config.shortname+".disqus.com"],r=0,n=0,o=function(){e.length===r&&r===n?a():e.length===r&&q()},s=0,t=e;s<t.length;s++)(e=>{var s=new Image,t=setTimeout(function(){s.onerror=s.onload=null,r++,o()},3e3);s.onerror=function(){clearTimeout(t),r++,o()},s.onload=function(){clearTimeout(t),r++,n++,o()},s.src="https://"+e+"/favicon.ico?"+ +new Date+"="+ +new Date})(t[s])}function p(){v("dsqjs-reload-disqus").addEventListener(j,f),v("dsqjs-force-disqus").addEventListener(j,a)}function t(){g("评论基础模式加载中... "+T),p();var e=_.config.api+"3.0/threads/list.json?forum="+_.config.shortname+"&thread=ident:"+_.config.identifier+"&api_key="+M();function s(e){function n(e){return{comment:e,author:e.author.name,isPrimary:!!_.config.admin&&e.author.username===_.config.admin,children:s(+e.id),hasMore:e.hasMore}}function s(e){if(0===o.length)return null;for(var s=[],t=_createForOfIteratorHelperLoose(o);!(r=t()).done;){var r=r.value;r.parent===e&&s.unshift(n(r))}return s.length?s:null}var t=[],o=[];return e.forEach(function(e){(e.parent?o:t).push(e)}),t.map(n)}w(e).then(function(e){e=e.data;if(0===e.code&&1===e.response.length){var s=e.response[0],t=s.id,r=s.posts;_.page={id:t,title:s.title,isClosed:s.isClosed,length:r,comment:[]},v(l).innerHTML='<div id="dsqjs"><div id="dsqjs-msg">评论基础模式加载中... '+T+"</div>"+L(r,_.config.siteName)+'<section class="dsqjs-post-container"><ul class="dsqjs-post-list" id="dsqjs-post-container"><p class="dsqjs-no-comment">评论列表加载中...</p></ul><a id="dsqjs-load-more" class="dsqjs-load-more dsqjs-hide">加载更多评论</a></section>'+y+"</div>",p(),v("dsqjs-order-"+_.sortType).setAttribute("checked","true"),n()}else{if(0!==e.code||1===e.response.length)throw new Error;g('当前 Thread 尚未创建。是否切换至 <a id="dsqjs-force-disqus" class="dsqjs-msg-btn">完整 Disqus 模式</a>？'),v("dsqjs-force-disqus").addEventListener(j,a)}}).catch(o);var n=function s(e){function t(){for(var e,s=_createForOfIteratorHelperLoose(i);!(e=s()).done;)e.value.removeEventListener("change",l);a.removeEventListener(j,c);for(var t,r=_createForOfIteratorHelperLoose(d);!(t=r()).done;)t.value.removeEventListener(j,f)}void 0===e&&(e="");var a=v("dsqjs-load-more"),i=h.getElementsByClassName("dsqjs-order-radio"),d=h.getElementsByClassName("dsqjs-has-more-btn"),c=function(){t(),s(_.page.next)},l=function(e){e=e.target;_.sortType=e.getAttribute("value"),D(b,_.sortType),t(),_.page.comment=[],_.page.next="",v("dsqjs-post-container").innerHTML='<p class="dsqjs-no-comment">正在切换排序方式...</p>',a.classList.add("dsqjs-hide"),s()},r=""===e?"":"&cursor="+e;function n(e){e=e.createdAt;return Date.parse(new Date(e))}function u(e,s){return e.parent&&s.parent?n(e)-n(s):0}a.classList.add("dsqjs-disabled");r=_.config.api+"3.0/threads/listPostsThreaded?forum="+_.config.shortname+"&thread="+_.page.id+r+"&api_key="+M()+"&order="+_.sortType;w(r).then(function(e){var s,e=e.data;if(0===e.code&&0<e.response.length){a.classList.remove("dsqjs-disabled"),(s=_.page.comment).push.apply(s,e.response),_.page.comment.sort(u),m(_.page.comment);for(var t,r=_createForOfIteratorHelperLoose(i);!(t=r()).done;)t.value.addEventListener("change",l);for(var n,o=_createForOfIteratorHelperLoose(d);!(n=o()).done;)n.value.addEventListener(j,f);e.cursor.hasNext?(_.page.next=e.cursor.next,a.innerHTML="加载更多评论",a.classList.remove("dsqjs-hide"),a.addEventListener(j,c)):a.classList.add("dsqjs-hide")}else{if(0!==e.code||0!==e.response.length)throw new Error;g("你可能无法访问 Disqus，已启用评论基础模式。"+T),v("dsqjs-post-container").innerHTML='<p class="dsqjs-no-comment" >'+_.config.nocomment+"</p>",p(),v("dsqjs-force-disqus").addEventListener(j,q)}}).catch(function(){""===e?o():(a.classList.remove("dsqjs-disabled"),a.innerHTML="加载更多评论失败，点击重试",a.addEventListener(j,c))})},m=function(e){function o(e){return e.comment.author.profileUrl?(e.comment.avatarEl='<a href="'+e.comment.author.profileUrl+'"><img src="'+r(e.comment.author.avatar.cache)+'" '+u+"></a>",e.comment.authorEl='<span class="dsqjs-post-author"><a href="'+e.comment.author.profileUrl+'" '+u+">"+e.comment.author.name+"</a></span>"):(e.comment.avatarEl='<img src="'+r(e.comment.author.avatar.cache)+'">',e.comment.authorEl='<span class="dsqjs-post-author">'+e.comment.author.name+"</span>"),_.config.adminLabel&&e.isPrimary&&(e.comment.authorEl+='<span class="dsqjs-admin-badge">'+_.config.adminLabel+"</span>"),e}function a(e){var s="",t=e.isDeleted?"<small>此评论已被删除</small>":(s=e.authorEl+'<span class="dsqjs-bullet"></span>',(e=>{var s=h.createElement("div");s.innerHTML=e;for(var t=_createForOfIteratorHelperLoose(s.getElementsByTagName("a"));!(r=t()).done;){var r=r.value,n=decodeURIComponent(r.href.replace(/https:\/\/disq.us\/url\?url=/g,"")).replace(/(.*):.+cuid=.*/,"$1");r.href=n,r.innerHTML=n,r.rel="external noopener nofollow noreferrer",r.target="_blank"}return s.innerHTML})(r(e.message)));return E(e,s,t)}function r(e){return e.replace("/a.disquscdn.com/ig","c.disquscdn.com")}var t="";s(e).map(function(e){e.children&&(e.nesting=1);var s="";(e=o(e)).hasMore&&(s='<p class="dsqjs-has-more">切换至 <a id="load-more-'+e.comment.id+'">完整 Disqus 模式</a> 显示更多回复</p>'),t+='<li data-id="comment-'+e.comment.id+'" id="comment-'+e.comment.id+'">'+a(e.comment)+function t(e){var r,n=e.nesting,e=e.children||[];if(e)return r="",r=n<_.config.nesting?'<ul class="dsqjs-post-list dsqjs-children">':'<ul class="dsqjs-post-list">',e.map(function(e){(e=o(e)).nesting=n+1;var s="";e.hasMore&&(s='<p class="dsqjs-has-more">切换至 <a class="dsqjs-has-more-btn" id="load-more-'+e.comment.id+'" data-more-id="comment-'+e.comment.id+'">完整 Disqus 模式</a> 显示更多回复</p>'),r+='<li data-id="comment-'+e.comment.id+'" id="comment-'+e.comment.id+'">'+a(e.comment)+t(e)+s+"</li>"}),0!==(r+="</ul>").length?r:void 0}(e)+s+"</li>"}),g("你可能无法访问 Disqus，已启用评论基础模式。"+T),v("dsqjs-post-container").innerHTML=t,p()}}function o(e){console.log(e),g('评论基础模式加载失败，是否 <a id="dsqjs-reload-dsqjs" class="dsqjs-msg-btn">重载</a> 或 <a id="dsqjs-reload-disqus" class="dsqjs-msg-btn">尝试完整 Disqus 模式</a> ？'),v("dsqjs-reload-dsqjs").addEventListener(j,t),v("dsqjs-reload-disqus").addEventListener(j,f)}function q(){D("dsqjs_mode","dsqjs"),t()}function a(){D("dsqjs_mode","disqus"),s()}var n,h,i,d,c,v,g,j,l,b,u,y,L,E,T,w,D,m,_,I,H,M;n=window,h=document,i=localStorage,d=fetch,c=Promise,v=function(e){return h.getElementById(e)},g=function(e){var s=v("dsqjs-msg");s&&(s.innerHTML=e)},j="click",l="disqus_thread",b="dsqjs_sort",y='<footer><p class="dsqjs-footer">Powered by <a class="dsqjs-disqus-logo" href="https://disqus.com" '+(u='target="_blank" rel="external nofollow noopener noreferrer"')+'></a>&nbsp;&amp;&nbsp;<a href="https://disqusjs.skk.moe" target="_blank">DisqusJS</a></p></footer>',L=function(e,s){return'<header class="dsqjs-header" id="dsqjs-header"><nav class="dsqjs-nav dsqjs-clearfix"><ul><li class="dsqjs-nav-tab dsqjs-tab-active"><span>'+e+' Comments</span></li><li class="dsqjs-nav-tab">'+s+'</li></ul><div class="dsqjs-order"><input class="dsqjs-order-radio" id="dsqjs-order-desc" type="radio" name="comment-order" value="desc" checked="true"><label class="dsqjs-order-label" for="dsqjs-order-desc" title="按从新到旧">最新</label><input class="dsqjs-order-radio" id="dsqjs-order-asc" type="radio" name="comment-order" value="asc"><label class="dsqjs-order-label" for="dsqjs-order-asc" title="按从旧到新">最早</label><input class="dsqjs-order-radio" id="dsqjs-order-popular" type="radio" name="comment-order" value="popular"><label class="dsqjs-order-label" for="dsqjs-order-popular" title="按评分从高到低">最佳</label></div></nav></header>'},E=function(e,s,t){return'<div class="dsqjs-post-item dsqjs-clearfix"><div class="dsqjs-post-avatar">'+e.avatarEl+'</div><div class="dsqjs-post-body"><div class="dsqjs-post-header">'+s+'<span class="dsqjs-meta"><time>'+m(e.createdAt)+'</time></span></div><div class="dsqjs-post-content">'+t+"</div></div></div>"},T='如需完整体验请针对 disq.us | disquscdn.com | disqus.com 启用代理并 <a id="dsqjs-reload-disqus" class="dsqjs-msg-btn">尝试完整 Disqus 模式</a> | <a id="dsqjs-force-disqus" class="dsqjs-msg-btn">强制完整 Disqus 模式</a>',w=function(e){return d(e,{method:"GET"}).then(function(e){return c.all([e.ok,e.status,e.json(),e.headers])}).then(function(e){var s=e[0];if(s)return{ok:s,status:e[1],data:e[2],headers:e[3]};throw new Error}).catch(function(e){throw e})},D=function(e,s){try{i.setItem(e,s)}catch(e){}},m=function(e){function s(e){return e<10?"0"+e:e}return e=Date.parse(new Date(e)),(e=new Date(e+288e5)).getFullYear()+"-"+s(e.getMonth()+1)+"-"+s(e.getDate())+" "+s(e.getHours())+":"+s(e.getMinutes())},_={},I=h.location.origin+h.location.pathname+h.location.search,_.config=r({api:"https://disqus.skk.moe/disqus/",identifier:I,url:I,title:h.title,siteName:"",nesting:parseInt(e.nesting)||4,nocomment:"这里冷冷清清的，一条评论都没有"},e),_.page={},H=_.config.apikey,M=function(){return Array.isArray(H)?H[Math.floor(Math.random()*H.length)]:H},n.disqus_config=function(){this.page.url=_.config.url,this.page.identifier=_.config.identifier,this.page.title=_.config.title},v(l).innerHTML='<div id="dsqjs"><div id="dsqjs-msg"></div>'+y+"</div>",(d&&i&&c?(_.mode=i.getItem("dsqjs_mode"),_.sortType=i.getItem(b)||i.getItem("disqus.sort"),_.sortType||(D(b,"desc"),_.sortType="desc"),"disqus"===_.mode?s:"dsqjs"===_.mode?t:f):(g("你的浏览器版本过低，不兼容评论基础模式。"+T),p))()}try{module.exports=DisqusJS}catch(e){}